<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.10.xsd">

    <changeSet id="create-users-friends-table" author="your-name">
        <sql>
        <![CDATA[
            CREATE TABLE IF NOT EXISTS users_friends
            (
                id BIGINT GENERATED ALWAYS AS IDENTITY,
                user_id BIGINT not null,
                friend_id BIGINT not null,
                status varchar(255) not null,
                created_date timestamp not null,
                primary key (id)
                );

            ALTER TABLE users_friends ADD CONSTRAINT fk_user FOREIGN KEY(user_id) REFERENCES users(id);
            ALTER TABLE users_friends ADD CONSTRAINT fk_friend FOREIGN KEY(friend_id) REFERENCES users(id);

            CREATE INDEX IF NOT EXISTS idx_user_friend ON users_friends(user_id, friend_id)
            ]]>
    </sql>
    </changeSet>
</databaseChangeLog>